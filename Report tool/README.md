# Sentinel & Defender XDR HLD Report Generator

This folder contains Python scripts that generate professional **High-Level Design (HLD) audit reports** in Microsoft Word format from CSV exports generated by the Sentinel and Defender XDR audit tools.

## ğŸ“‹ Overview

The `generate_sentinel_hld_report.py` script takes CSV files from the audit tools and creates a comprehensive Word document that includes:

**Microsoft Sentinel Data:**
- Analytic Rules
- Data Connectors  
- SOC Recommendations
- SOC Rule Efficiency
- SOC Data Ingestion

**Microsoft Defender XDR Data (Optional):**
- Security Alerts
- Security Incidents
- Attack Simulation Training
- Microsoft Secure Score

The report is suitable for:
- **Customer deliverables**
- **Internal security assessments**
- **Compliance documentation**
- **Executive reporting**

## ğŸš€ Quick Start

### Prerequisites

**Option 1: Automated Setup (Recommended)**
```bash
# Run the setup script to install all dependencies
python setup.py
```

**Option 2: Manual Installation**
```bash
# Install dependencies manually
pip install -r requirements.txt

# Or install individually
pip install pandas python-docx openpyxl
```

### Basic Usage

### Basic Usage (Sentinel Only)
```bash
python generate_sentinel_hld_report.py \
    --analytic-rules "../Sentinel Audit/sentinel_analytic_rules_20241105_103210.csv" \
    --data-connectors "../Sentinel Audit/sentinel_data_connectors_20241105_103210.csv" \
    --soc-ingestion "../Sentinel SOC Optimisation Audit/soc_data_ingestion_20241105_105531.csv" \
    --soc-recommendations "../Sentinel SOC Optimisation Audit/soc_recommendations_20241105_105531.csv" \
    --soc-rule-efficiency "../Sentinel SOC Optimisation Audit/soc_rule_efficiency_20241105_105531.csv" \
    --customer-name "Just Group" \
    --output "JustGroup_Sentinel_HLD_Audit_Report.docx"
```

### Enhanced Usage (Sentinel + Defender XDR)
```bash
python generate_sentinel_hld_report.py \
    --analytic-rules "../Sentinel Audit/sentinel_analytic_rules_20241105_103210.csv" \
    --data-connectors "../Sentinel Audit/sentinel_data_connectors_20241105_103210.csv" \
    --soc-ingestion "../Sentinel SOC Optimisation Audit/soc_data_ingestion_20241105_105531.csv" \
    --soc-recommendations "../Sentinel SOC Optimisation Audit/soc_recommendations_20241105_105531.csv" \
    --soc-rule-efficiency "../Sentinel SOC Optimisation Audit/soc_rule_efficiency_20241105_105531.csv" \
    --xdr-security-alerts "../Defender XDR Audit/defender_xdr_security_alerts_20241105_140322.csv" \
    --xdr-security-incidents "../Defender XDR Audit/defender_xdr_security_incidents_20241105_140322.csv" \
    --xdr-attack-simulations "../Defender XDR Audit/defender_xdr_attack_simulations_20241105_140322.csv" \
    --xdr-secure-score "../Defender XDR Audit/defender_xdr_secure_score_20241105_140322.csv" \
    --customer-name "Just Group" \
    --output "JustGroup_Combined_Security_Audit_Report.docx"
```

### Automated Usage (With Auto-Detection)
The script can automatically detect XDR files and customer names:
```bash
# Auto-detects XDR files and customer name
python run_combined_report.py
```

## ğŸ“Š Report Sections

The generated Word document includes:

### 1. Executive Summary
- **Overview** of Sentinel deployment status
- **Risk assessment** (Low/Medium/High)
- **Key metrics** summary
- **Recommendations** overview

### 2. Data Connectors Analysis
- **Connector inventory** with types and status
- **Coverage assessment** for core security sources
- **Risk rating**: Medium - Focus on Identity, Email, Endpoint, Perimeter

### 3. Analytic Rules Assessment
- **Rule inventory** with names and status
- **MITRE ATT&CK coverage** analysis
- **Enabled vs. disabled** rule breakdown
- **Risk rating**: Medium - Ensure priority rules are active

### 4. SOC Recommendations
- **Outstanding recommendations** from optimization analysis
- **Priority actions** for improvement
- **Risk rating**: Medium - Track recommendations to closure

### 5. SOC Rule Efficiency
- **True/false positive rates** per rule
- **Performance metrics** and tuning opportunities
- **Risk rating**: Low - Continue optimization efforts

### 6. SOC Data Ingestion
- **Data volume analysis** by source
- **Cost implications** and optimization opportunities
- **Coverage gaps** identification
- **Risk rating**: Medium - Address ingestion gaps

### 7-10. Defender XDR Sections (When Available)
When XDR data is provided, additional sections are included:

### 7. Defender XDR Security Alerts
- **Active security alerts** from M365 Defender
- **Severity breakdown** (High, Medium, Low)
- **Risk rating**: Medium - Review and triage alerts

### 8. Defender XDR Security Incidents
- **Security incidents** and status
- **Assignment and resolution tracking**
- **Risk rating**: Medium - Ensure timely resolution

### 9. Defender XDR Attack Simulations
- **Phishing simulation campaigns**
- **User training effectiveness**
- **Risk rating**: Low - Continue user awareness training

### 10. Defender XDR Secure Score
- **Current security posture percentage**
- **Enabled services and licensed users**
- **Risk rating**: Low-Medium - Improve based on recommendations

## ğŸ¨ Report Features

### Professional Formatting
- **Calibri font** (11pt) throughout
- **Styled tables** with alternating row colors
- **Header shading** (grey) for table headers
- **Center-aligned tables** with proper cell alignment

### Data Presentation
- **Preview tables** (10 rows by default, configurable)
- **Record counts** for each section
- **Empty data handling** with "No data found" messages
- **Risk ratings** for each section

### Customization Options
- **Customer name** in report header
- **Preview row count** (--preview-rows)
- **Output filename** customization
- **Timestamp** in UTC format

## ğŸ“ Input Files Required

The script expects 5 CSV files from the audit tools:

```
Required CSV Files:
â”œâ”€â”€ sentinel_analytic_rules_YYYYMMDD_HHMMSS.csv      # From basic audit
â”œâ”€â”€ sentinel_data_connectors_YYYYMMDD_HHMMSS.csv     # From basic audit
â”œâ”€â”€ soc_data_ingestion_YYYYMMDD_HHMMSS.csv           # From SOC optimization
â”œâ”€â”€ soc_recommendations_YYYYMMDD_HHMMSS.csv          # From SOC optimization
â””â”€â”€ soc_rule_efficiency_YYYYMMDD_HHMMSS.csv          # From SOC optimization
```

## ğŸ”§ Command Line Options

| Parameter | Required | Default | Description |
|-----------|----------|---------|-------------|
| `--analytic-rules` | âœ… Yes | - | Path to analytic rules CSV |
| `--data-connectors` | âœ… Yes | - | Path to data connectors CSV |
| `--soc-ingestion` | âœ… Yes | - | Path to SOC ingestion CSV |
| `--soc-recommendations` | âœ… Yes | - | Path to SOC recommendations CSV |
| `--soc-rule-efficiency` | âœ… Yes | - | Path to SOC rule efficiency CSV |
| `--customer-name` | âŒ No | "Just Group" | Customer name for report header |
| `--output` | âŒ No | "sentinel_hld_audit.docx" | Output Word document filename |
| `--preview-rows` | âŒ No | 10 | Number of rows to show in each table |

## ğŸ’¡ Usage Examples

### Basic Report Generation
```bash
# Generate report with default customer name
python generate_sentinel_hld_report.py \
    --analytic-rules "sentinel_analytic_rules_20241105_103210.csv" \
    --data-connectors "sentinel_data_connectors_20241105_103210.csv" \
    --soc-ingestion "soc_data_ingestion_20241105_105531.csv" \
    --soc-recommendations "soc_recommendations_20241105_105531.csv" \
    --soc-rule-efficiency "soc_rule_efficiency_20241105_105531.csv"
```

### Custom Customer Report
```bash
# Generate report for specific customer with custom filename
python generate_sentinel_hld_report.py \
    --analytic-rules "../Sentinel Audit/sentinel_analytic_rules_20241105_103210.csv" \
    --data-connectors "../Sentinel Audit/sentinel_data_connectors_20241105_103210.csv" \
    --soc-ingestion "../Sentinel SOC Optimisation Audit/soc_data_ingestion_20241105_105531.csv" \
    --soc-recommendations "../Sentinel SOC Optimisation Audit/soc_recommendations_20241105_105531.csv" \
    --soc-rule-efficiency "../Sentinel SOC Optimisation Audit/soc_rule_efficiency_20241105_105531.csv" \
    --customer-name "Contoso Corporation" \
    --output "Contoso_Sentinel_Assessment_2024.docx" \
    --preview-rows 15
```

### GitHub Actions Integration
```bash
# Use with GitHub Actions (assuming CSV files are in artifacts)
python generate_sentinel_hld_report.py \
    --analytic-rules "./audit-artifacts/sentinel_analytic_rules_*.csv" \
    --data-connectors "./audit-artifacts/sentinel_data_connectors_*.csv" \
    --soc-ingestion "./soc-artifacts/soc_data_ingestion_*.csv" \
    --soc-recommendations "./soc-artifacts/soc_recommendations_*.csv" \
    --soc-rule-efficiency "./soc-artifacts/soc_rule_efficiency_*.csv" \
    --customer-name "${{ env.CUSTOMER_NAME }}" \
    --output "sentinel_hld_report_${{ github.run_number }}.docx"
```

## ğŸ› ï¸ Dependencies

Create a `requirements.txt` file:

```txt
pandas>=1.5.0
python-docx>=0.8.11
openpyxl>=3.0.10
```

Install dependencies:
```bash
pip install -r requirements.txt
```

## ğŸ¯ Output Sample

The generated Word document will contain:

```
Just Group â€“ Microsoft Sentinel High-Level Design (HLD) Audit Report
Generated: 2024-11-05 10:55 UTC

This HLD report assesses the Microsoft Sentinel deployment, focusing on data 
connector health, analytic rule coverage, SOC recommendations, and operational 
efficiency. It includes risk ratings and prioritised remediation actions based 
on supplied exports.

1. Executive Summary
Sentinel is operational with 6 data connectors and 358 analytic rules.
Overall risk: Medium â€” improvements recommended in connector completeness, 
rule enablement consistency, and ingestion coverage.

2. Data Connectors
Risk: Medium â€“ Validate core sources (Identity, Email, Endpoint, Perimeter) 
are healthy and sending.

[Professional styled table with connector data]

...and so on for all sections
```

## ğŸ” Data Processing Features

### Intelligent Data Detection
- **Auto-detects enabled rules** from various column names:
  - `enabled`, `is_enabled`, `ruleenabled`
  - Handles boolean, string, and numeric formats
- **Handles missing data** gracefully with "No data found" messages
- **Processes all column types** (text, numbers, booleans)

### Table Styling
- **Alternating row colors** for readability
- **Header highlighting** with grey background
- **Professional typography** with consistent spacing
- **Center alignment** for optimal presentation

## ğŸš¨ Troubleshooting

### Common Issues

1. **Missing CSV Files**
   ```bash
   # Error: FileNotFoundError
   # Solution: Check file paths and ensure all 5 CSV files exist
   ls -la *.csv
   ```

2. **Empty Tables**
   ```bash
   # Issue: "No data found" in sections
   # Solution: Verify CSV files contain data and have proper headers
   head -5 your_csv_file.csv
   ```

3. **Formatting Issues**
   ```bash
   # Issue: Word document formatting problems
   # Solution: Ensure python-docx is latest version
   pip install --upgrade python-docx
   ```

### Validation Steps

1. **Check CSV files exist and contain data**:
   ```bash
   wc -l *.csv  # Should show line counts > 1
   ```

2. **Verify CSV headers**:
   ```bash
   head -1 *.csv  # Check for proper column names
   ```

3. **Test basic execution**:
   ```bash
   python generate_sentinel_hld_report.py --help
   ```

## ğŸ”„ Integration with Audit Tools

This report generator is designed to work seamlessly with:

- **Basic Sentinel Audit** (`../Sentinel Audit/`)
- **SOC Optimization Analysis** (`../Sentinel SOC Optimisation Audit/`)

### Typical Workflow

1. **Run audit tools** to generate CSV files
2. **Execute report generator** with CSV files as input
3. **Review generated Word document**
4. **Customize and distribute** to stakeholders

## ğŸ“ License

This script is part of the Sentinel Audit & SOC Optimization Tools suite and follows the same MIT License.

## ğŸ¤ Contributing

Contributions welcome! Areas for enhancement:
- Additional report sections
- More styling options
- PDF output support
- Chart/graph generation
- Email distribution integration

---

**Generate professional Sentinel audit reports in seconds! ğŸ“Š**